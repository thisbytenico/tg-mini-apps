import{_ as t,v as e,al as o,$ as s,Q as i,E as a,A as l,C as n,x as r,y as d,G as f,H as m,L as u,h,w as c,Y as p,p as I,O as _,g as b,i as T,l as g,t as E,I as C,J as y,K as U}from"./index-Ci2ntzNm.js";import{_ as A}from"./u-datetime-picker.BwvSjS2q.js";import{_ as w}from"./dw-card.fADXVOCt.js";import{_ as N}from"./u-button.DGq9rRfM.js";import"./u-picker.umNqIkHP.js";import"./u-loading-icon.CX2H3iv7.js";const j=t({name:"",components:{},data:()=>({config:e,timeFormat:o,isDefault:!0,productList:[],unitsList:[],title:"",fileList:[],info:{},baseInfo:{},form:{pickTime:(new Date).getTime(),agriProductionId:"",alias:"",baseId:"",sldw:"",shsl:"",shfzr:""}}),onLoad(t){this.info=JSON.parse(decodeURIComponent(t.info)),this.baseInfo=JSON.parse(decodeURIComponent(t.baseInfo)),this.title=t.title,console.log(this.info),console.log(this.baseInfo),this.form.baseId=this.info.BASE_ID,this.form.CurrentProductId=this.info.BASE_ID,this.form.productCode=this.info.AGRI_PRODUCT_CODE,this.form.productNames=this.info.AGRI_PRODUCT_NAME,s("selectEmployee",(t=>{this.form.shfzr=t.STAFF_NAME})),this.ajaxGetUnitList(),this.ajaxGetProductList(),this.ajaxGetDefaultUser()},onUnload(){i("selectEmployee")},watch:{},computed:{},methods:{getIcon(t){switch(t.substring(0,2)){case"01":return"batch_planting";case"02":return"batch_livestock";default:return"batch_water"}},productConfirm(){this.form.productCode=this.productList.find((t=>t.productName===this.form.productNames)).productCode},sldwConfirm(){console.log(this.form.sldw),this.form.unitId=this.unitsList.find((t=>t.dictName===this.form.sldw)).id},actionJumpTo(t){a({url:t})},actionSubmit(){if(this.form.ztmc=l("userInfo").enterpriseName,this.form.hymc=this.info.INDUSTRY_TYPE,this.form.jdmc=this.baseInfo.NAME,this.form.jdbh=this.baseInfo.NAME,this.form.jddz=this.baseInfo.ADDRESS_NAME,this.form.jdmj=this.baseInfo.AREA,this.form.jdmjdw=this.baseInfo.DICT_NAME,this.form.jdfzr=this.baseInfo.MANAGER,this.form.latitude=this.baseInfo.LATITUDE,this.form.longitude=this.baseInfo.LONGITUDE,this.form.basePic=[this.baseInfo.PICTURE,this.baseInfo.PICTURE_TWO].filter((t=>t)).join(","),this.form.productType=this.info.INDUSTRY_TYPE,this.form.batchPhoto=this.$refs.myFileUploadRef.fileList.map((t=>t.resourceUrl)).join(","),this.form.agriProductionId=this.info.ID,this.form.startTime=this.info.CREATE_TIME,this.form.baseId=this.baseInfo.ID,this.form.symj=this.baseInfo.AREA,this.form.symjdw=this.baseInfo.DICT_NAME,this.form.imgId=this.$refs.myFileUploadRef.fileList.map((t=>t.id)).join(","),this.form.tempEnId=l("userInfo").id,this.form.isPick="N","收获"==this.title&&(this.form.isPick="Y"),"收获"==this.title&&!this.form.productNames)return void n("请选择收获产品");if(!this.form.shsl)return void n("请输入数量");if(!this.form.sldw)return void n("请选择单位");if(!this.form.shfzr)return void n("请选择负责人");if(!this.form.pickTime)return void n("请选择"+this.title+"时间");let t="1";switch(this.info.INDUSTRY_TYPE){case"01":break;case"02":t="6";break;case"03":t="4"}this.form.joinFlag=t,a({url:"/pages/batch/createTraceCode?info="+encodeURIComponent(JSON.stringify(this.form))+"&title="+this.title})},actionDelete(t){this.fileList.splice(t.index,1),r({icon:"none",title:"删除图片"})},afterRead(){},formatter:(t,e)=>"year"===t?`${e}年`:"month"===t?`${e}月`:"day"===t?`${e}日`:"hour"===t?`${e}时`:"minute"===t?`${e}分`:e,ajaxXxx(){},ajaxGetProductList(){d.post("sofn-tts-web-branch/ttsTrace/getByProductList?id="+l("userInfo").id,{agriCode:this.info.AGRI_PRODUCT_CODE},{header:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",token:l("token")},toast:!1}).then((t=>{200===t.httpCode?this.productList=t.data:r({icon:"none",title:t.msg})}))},ajaxGetUnitList(){d.post("sofn-tts-web-branch/ttsScltxxcjScgl/getUnits",{id:e.industryCodes.find((t=>t.num===this.info.INDUSTRY_TYPE)).code},{header:{"Content-Type":"application/x-www-form-urlencoded",token:l("token")},toast:!1}).then((t=>{this.unitsList=t}))},ajaxGetDefaultUser(){d.post("sofn-tts-web-branch/ttsScltxxcjStaff/getPageInfo",{start:0,length:99999,id:l("userInfo").id},{header:{"Content-Type":"application/x-www-form-urlencoded",token:l("token")},toast:!1}).then((t=>{if(t.data.list&&t.data.list.length>0){let e=t.data.list.find((t=>"Y"==t.DEFAULT_STATUS));e&&(this.form.shfzr=e.STAFF_NAME)}}))}}},[["render",function(t,e,o,s,i,a){const l=f(m("u-navbar"),p),n=y,r=I,d=u("mySelectBox"),j=u("myInputBox"),R=U,x=u("myFormItem"),D=f(m("u-datetime-picker"),A),k=f(m("dw-icon"),_),S=u("myContent"),L=u("myFileUpload"),P=f(m("dw-card"),w),v=f(m("u-button"),N);return b(),h(r,{class:"harvest"},{default:c((()=>[T(l,{title:i.title,autoBack:!0,placeholder:"",border:""},null,8,["title"]),T(r,{class:"harvest-body"},{default:c((()=>[T(r,{class:"harvest-goods"},{default:c((()=>[T(n,{class:"harvest-goods-icon",src:"../../static/images/"+a.getIcon(i.info.INDUSTRY_TYPE)+".png"},null,8,["src"]),T(r,{class:"harvest-goods-body"},{default:c((()=>[T(r,{class:"flex justify-between"},{default:c((()=>[T(r,null,{default:c((()=>[g(E(i.info.AGRI_PRODUCT_NAME),1)])),_:1}),T(r,null,{default:c((()=>[g(E(i.config.getAreaText(i.info.INDUSTRY_TYPE))+":"+E(i.info.AREA)+E(i.info.AREA_UNIT),1)])),_:1})])),_:1}),T(r,{class:"justify-between mt8"},{default:c((()=>[T(r,{class:"text-desc ft14"},{default:c((()=>[g("基地名称："+E(i.baseInfo.NAME),1)])),_:1}),T(r,{class:"text-desc ft14"},{default:c((()=>[g("开始时间："+E(i.timeFormat(i.info.CREATE_TIME,"yyyy-mm-dd")),1)])),_:1})])),_:1})])),_:1})])),_:1}),T(x,{label:"产品和名称",col:"2"},{default:c((()=>["收获"==i.title?(b(),h(j,{key:0},{default:c((()=>[T(d,{placeholder:"选择产品",value:"米粉",onOnChange:a.productConfirm,modelValue:i.form.productNames,"onUpdate:modelValue":e[0]||(e[0]=t=>i.form.productNames=t),options:i.productList.map((t=>t.productName))},null,8,["onOnChange","modelValue","options"])])),_:1})):C("",!0),T(j,null,{default:c((()=>[T(R,{modelValue:i.form.alias,"onUpdate:modelValue":e[1]||(e[1]=t=>i.form.alias=t),style:{width:"100%"},type:"text",placeholder:"输入品种名称"},null,8,["modelValue"])])),_:1})])),_:1}),T(x,{label:"数量和单位",col:"2"},{default:c((()=>[T(j,null,{default:c((()=>[T(R,{modelValue:i.form.shsl,"onUpdate:modelValue":e[2]||(e[2]=t=>i.form.shsl=t),style:{width:"100%"},type:"text",placeholder:"请输入数量"},null,8,["modelValue"])])),_:1}),i.unitsList.length>0?(b(),h(j,{key:0},{default:c((()=>[T(d,{onOnChange:a.sldwConfirm,modelValue:i.form.sldw,"onUpdate:modelValue":e[3]||(e[3]=t=>i.form.sldw=t),placeholder:"请选择单位",title:"单位",defaultValue:"",options:i.unitsList.map((t=>t.dictName))},null,8,["onOnChange","modelValue","options"])])),_:1})):C("",!0)])),_:1}),T(x,{label:"出栏时间和负责人",col:"2"},{default:c((()=>[T(j,null,{default:c((()=>[T(D,{modelValue:i.form.pickTime,"onUpdate:modelValue":e[4]||(e[4]=t=>i.form.pickTime=t),hasInput:"",mode:"datetime",formatter:a.formatter},null,8,["modelValue","formatter"]),T(k,{name:"right",color:"#666",size:"24rpx"})])),_:1}),T(j,null,{default:c((()=>[T(S,{onClick:e[5]||(e[5]=t=>a.actionJumpTo("/pages/employee/select")),placeholder:"请选择",value:i.form.shfzr},null,8,["value"])])),_:1})])),_:1}),T(x,{label:"产品图片"},{default:c((()=>[T(P,null,{default:c((()=>[T(L,{ref:"myFileUploadRef",maxCount:5},null,512)])),_:1})])),_:1})])),_:1}),T(r,{class:"harvest-footer"},{default:c((()=>[T(v,{style:{background:"#00b568",color:"#fff"},onClick:a.actionSubmit},{default:c((()=>[g("下一步")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-2fc3af5d"]]);export{j as default};
