import{_ as e,$ as t,A as l,Q as o,E as a,x as s,y as i,W as n,X as r,v as d,G as u,H as m,L as c,h as p,w as f,p as h,Y as _,O as g,a4 as T,g as y,i as U,l as V,I as v,k as C,r as k,F as I,K as b,t as x}from"./index-CBLTQg_b.js";import{_ as R}from"./u-datetime-picker.BDTYO2Mk.js";import{_ as w}from"./dw-card.CeBHaIwR.js";import"./u-picker.BPw4DyFW.js";import"./u-loading-icon.Bdr6stTV.js";const S=e({name:"",components:{},data:()=>({isDefault:!0,pageTitle:"",unitsList:[],inputsType:["无","有机食品","绿色食品","农产品地理标识"],materials:[],form:{unit:"千克",harvestBaseid:"",harvestBasename:"",harvestTime:new Date,imgId:"",joinFlag:"",mediCheck:"自检",mediResult:"合格",productAmount:"",productId:"",productIndustry:"",productName:"",productSort:"",unitId:"",tempEnId:""},fileList:[]}),onLoad(e){this.ajaxGetUnitList(),t("productSelect",(e=>{console.log(e),this.form.productId=e.PRODUCT_CODE,this.form.productIndustry=e.INDUSTRY,this.form.productSort=e.TYPE_NAME,this.form.productName=e.NAME})),t("workshopSelect",(e=>{console.log(e),this.form.harvestBaseid=e.ID,this.form.harvestBasename=e.NAME})),t("processMaterialsSelect",(e=>{console.log(e),this.materials=e.map((e=>({harvestUnit:e.HARVEST_UNIT,materialId:e.ID,materialTraceCode:e.PRODUCT_PC,productAmount:0,productName:e.PRODUCT_NAME,STORE_COUNT:e.STORE_COUNT})))})),this.form.tempEnId=l("userInfo").id},onUnload(){o("productSelect"),o("workshopSelect"),o("processMaterialsSelect")},watch:{},computed:{},methods:{actionJumpTo(e){a({url:e})},actionSubmit(){if(this.form.imgId=this.$refs.myFileUploadRef.fileList.map((e=>e.id)).join(","),this.form.videoId=this.$refs.myFileUploadVideoRef.fileList.map((e=>e.id)).join(","),this.form.unitId=this.unitsList.find((e=>e.dictName==this.form.unit)).id,"不合格"!=this.form.mediResult)if(this.form.productId)if(this.form.productAmount)if(this.form.harvestBaseid)if(this.form.harvestTime)if(this.materials.length){for(const e of this.materials){if(e.productAmount<=0)return void s({icon:"none",title:"请填写生产原料数量"});if(e.productAmount>e.STORE_COUNT)return void s({icon:"none",title:"生产原料数量不能大于库存数量"})}i.post("/sofn-tts-web-branch/ttsProcess/process",{materials:this.materials,scgl:this.form},{header:{token:l("token")},toast:!1}).then((e=>{s({icon:"none",title:e.msg}),200==e.httpCode?setTimeout((()=>{n("refreshProcessingList"),r({delta:1})}),1e3):s({icon:"none",title:e.msg})})),console.log(this.form)}else s({icon:"none",title:"请选择生产原料"});else s({icon:"none",title:"请选择生产时间"});else s({icon:"none",title:"请选择生产车间"});else s({icon:"none",title:"请填写生产数量"});else s({icon:"none",title:"请选择加工产品"});else s({icon:"none",title:"您的产品质检情况不合格，不能在国家平台登记"})},actionDelete(e){this.fileList.splice(e.index,1),s({icon:"none",title:"删除图片"})},afterRead(){},formatter:(e,t)=>"year"===e?`${t}年`:"month"===e?`${t}月`:"day"===e?`${t}日`:"hour"===e?`${t}时`:"minute"===e?`${t}分`:t,ajaxXxx(){},ajaxGetUnitList(){i.post("sofn-tts-web-branch/ttsScltxxcjScgl/getUnits",{id:d.industryCodes.find((e=>"04"===e.num)).code},{header:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",token:l("token")},toast:!1}).then((e=>{this.unitsList=e}))}}},[["render",function(e,t,l,o,a,s){const i=h,n=u(m("u-navbar"),_),r=c("myContent"),d=c("myInputBox"),S=c("myFormItem"),N=b,E=c("mySelectBox"),L=u(m("dw-icon"),g),A=u(m("u-datetime-picker"),R),O=c("myCheckbox"),j=u(m("dw-cell"),T),B=c("myFileUpload"),D=u(m("dw-card"),w);return y(),p(i,{class:"processing"},{default:f((()=>[U(n,{title:"加工",onRightClick:s.actionSubmit,autoBack:!0,placeholder:"",border:""},{right:f((()=>[U(i,{class:"u-nav-slot"},{default:f((()=>[V("提交")])),_:1})])),_:1},8,["onRightClick"]),U(i,{class:"processing-body"},{default:f((()=>[U(S,{label:"产品名称"},{default:f((()=>[U(d,null,{default:f((()=>[U(r,{value:a.form.productName,placeholder:"请选择产品",onClick:t[0]||(t[0]=e=>s.actionJumpTo("/pages/processing/productList"))},null,8,["value"])])),_:1})])),_:1}),U(S,{label:"生产数量/单位",col:"2"},{default:f((()=>[U(d,null,{default:f((()=>[U(N,{style:{width:"100%"},modelValue:a.form.productAmount,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.productAmount=e),type:"text",placeholder:"请输入数量"},null,8,["modelValue"])])),_:1}),U(d,null,{default:f((()=>[a.unitsList.length?(y(),p(E,{key:0,modelValue:a.form.unit,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.unit=e),placeholder:"请选择",title:"加工单位",defaultValue:a.unitsList[0].dictName,options:a.unitsList.map((e=>e.dictName))},null,8,["modelValue","defaultValue","options"])):v("",!0)])),_:1})])),_:1}),U(S,{label:"生产车间"},{default:f((()=>[U(d,null,{default:f((()=>[U(r,{value:a.form.harvestBasename,onClick:t[3]||(t[3]=e=>s.actionJumpTo("/pages/workshop/select")),placeholder:"请选择车间"},{icon:f((()=>[U(L,{name:"location-fill",color:"#278CEB"})])),_:1},8,["value"])])),_:1})])),_:1}),U(S,{label:"生产时间"},{default:f((()=>[U(d,{style:{padding:"0 24rpx 0 0 !important"}},{default:f((()=>[U(A,{modelValue:a.form.harvestTime,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.harvestTime=e),hasInput:"",mode:"date",formatter:s.formatter},null,8,["modelValue","formatter"]),U(L,{name:"calendar",color:"#278CEB"})])),_:1})])),_:1}),U(j,{"footer-border":!1,background:"transparent"},{footer:f((()=>[U(O,{modelValue:a.form.inputsType,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.inputsType=e),ref:"inputsTypeRef",options:a.inputsType},null,8,["modelValue","options"])])),default:f((()=>[U(i,null,{default:f((()=>[V("认证类型")])),_:1})])),_:1}),U(S,{label:"质检情况/结论",col:"2"},{default:f((()=>[U(d,null,{default:f((()=>[U(E,{placeholder:"请选择",title:"质检情况",modelValue:a.form.mediCheck,"onUpdate:modelValue":t[6]||(t[6]=e=>a.form.mediCheck=e),options:["自检","委托检查","抽检"]},null,8,["modelValue"])])),_:1}),U(d,null,{default:f((()=>[U(E,{placeholder:"请选择",title:"质检情况",modelValue:a.form.mediResult,"onUpdate:modelValue":t[7]||(t[7]=e=>a.form.mediResult=e),options:["合格","不合格"]},null,8,["modelValue"])])),_:1})])),_:1}),U(S,{label:"图片"},{default:f((()=>[U(D,{shape:"square"},{default:f((()=>[U(B,{ref:"myFileUploadRef"},null,512)])),_:1})])),_:1}),U(S,{label:"视频"},{default:f((()=>[U(D,{shape:"square"},{default:f((()=>[U(B,{ref:"myFileUploadVideoRef",title:"选择视频"},null,512)])),_:1})])),_:1}),U(S,{label:"生产原料信息"},{default:f((()=>[U(d,null,{default:f((()=>[U(r,{onClick:t[8]||(t[8]=e=>s.actionJumpTo("/pages/processing/raw")),placeholder:"请选择生产原料"})])),_:1})])),_:1}),U(i,{class:"raw-list"},{default:f((()=>[(y(!0),C(I,null,k(a.materials,((e,t)=>(y(),p(i,{class:"raw-list-item",key:t},{default:f((()=>[U(i,null,{default:f((()=>[U(i,null,{default:f((()=>[V(x(e.productName),1)])),_:2},1024),U(i,{class:"text-level2"},{default:f((()=>[V("库存:"+x(e.STORE_COUNT)+"("+x(e.harvestUnit)+")",1)])),_:2},1024)])),_:2},1024),U(i,{class:"flex",style:{display:"flex","align-items":"center"}},{default:f((()=>[U(N,{style:{"text-align":"center"},type:"number",modelValue:e.productAmount,"onUpdate:modelValue":t=>e.productAmount=t,class:"raw-list-item-input"},null,8,["modelValue","onUpdate:modelValue"]),V(" "+x(e.harvestUnit),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-01ed3545"]]);export{S as default};
