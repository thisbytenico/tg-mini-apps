import{_ as e,aJ as t,y as o,$ as a,Q as l,A as s,v as r,E as n,T as i,x as c,U as u,G as d,H as f,L as m,h as p,w as h,Y as g,p as y,O as b,a4 as _,g as k,i as x,l as T,t as C,J as S,q as w,K as A}from"./index-BdsNz36l.js";import{_ as U}from"./u-datetime-picker.p0m0mvIr.js";import{_ as B}from"./u-button.Di26Z4V2.js";import{_ as N}from"./nums.BUbf1Tpy.js";import"./u-picker.jXgJyPg4.js";import"./u-loading-icon.BXA7DYQS.js";const j=e({name:"",components:{},data:()=>({isDefault:!0,pageTitle:"",num:0,fileList:[],form:{traceCode:"",personSignUrl:"",amount:"",unit:"千克",address:"",eligibleWay:"",issueTime:(new Date).getTime(),phone:"",productPerson:"",issueSheets:"1",productName:"",productType:""}}),onLoad(e){this.ajaxGetDefaultUser();try{this.info=JSON.parse(decodeURIComponent(e.info)),this.form.productType=this.info.productType,this.form.traceCode=this.info.traceCode,this.form.unit=this.info.unit,this.form.count=this.info.count,this.form.productName=this.info.productName}catch(l){t({type:"wgs84",success:e=>{this.location=e.longitude+","+e.latitude;let t={location:this.location,key:"d246da9e7f79486b030fbcc4007b8fae"},a="";for(const o in t)a+=o+"="+t[o]+"&";o.get("https://restapi.amap.com/v3/geocode/regeo?"+a).then((e=>{"1"==e.status&&(this.form.address=e.regeocode.formatted_address)}))},fail:e=>{console.log(e)},finally:e=>{}})}a("selectBath",(e=>{console.log(e),this.form.unit=e.unit,this.form.traceCode=e.traceCode,this.form.count=e.count,this.form.productName=e.productName,this.form.productType=e.productType})),a("selectEmployee",(e=>{this.form.productPerson=e.STAFF_NAME,this.form.personSignUrl=e.SIGNATURE_URL,this.form.phone=e.PHONE})),a("selectAddress",(e=>{this.form.address=e.name}))},onUnload(){l("selectBath"),l("selectEmployee"),l("selectAddress")},watch:{},computed:{},methods:{ajaxGetDefaultUser(){o.post("sofn-tts-web-branch/ttsScltxxcjStaff/getPageInfo",{start:0,length:99999,id:s("userInfo").id},{header:{"Content-Type":"application/x-www-form-urlencoded",token:s("token")},toast:!1}).then((e=>{if(e.data.list&&e.data.list.length>0){let t=e.data.list.find((e=>"Y"==e.DEFAULT_STATUS));t&&(this.form.productPerson=t.STAFF_NAME)}}))},config:()=>r,actionJumpTo(e){n({url:e})},actionToSelectBatch(){n({url:"/pages/batch/select"})},actionSubmit(){i({title:"正在提交"}),console.log(this.form),o.post("/sofn-tts-web-branch/ttsCertification/addTtsCertification?id="+s("userInfo").id,{...this.form},{header:{token:s("token")},toast:!1}).then((e=>{200===e.httpCode?n({url:"/pages/qualificationCertificate/result?info="+encodeURIComponent(JSON.stringify(e.data))}):c({icon:"none",title:e.msg})})).finally((()=>{u()}))},actionDelete(e){this.fileList.splice(e.index,1),c({icon:"none",title:"删除图片"})},afterRead(){},formatter:(e,t)=>"year"===e?`${t}年`:"month"===e?`${t}月`:"day"===e?`${t}日`:"hour"===e?`${t}时`:"minute"===e?`${t}分`:t,ajaxXxx(){}}},[["render",function(e,t,o,a,l,s){const r=d(f("u-navbar"),g),n=S,i=y,c=d(f("dw-icon"),b),u=d(f("dw-cell"),_),j=w,V=m("myCheckbox"),q=m("myFormItem"),I=A,v=m("myContent"),D=m("myInputBox"),E=d(f("u-datetime-picker"),U),F=d(f("u-button"),B);return k(),p(i,{class:"qua-cert"},{default:h((()=>[x(r,{title:"开合格证",autoBack:!0,placeholder:"",border:""}),x(i,{class:"qua-cert-body"},{default:h((()=>[l.form.productName?(k(),p(i,{key:1,onClick:s.actionToSelectBatch,style:{margin:"20rpx",padding:"10rpx",background:"#fff"}},{default:h((()=>[x(i,{style:{display:"flex","justify-content":"space-between","margin-bottom":"10rpx"}},{default:h((()=>[x(j,null,{default:h((()=>[T("品种："+C(l.form.productName),1)])),_:1}),x(j,{style:{color:"#aaa"}},{default:h((()=>[T("批次总量"+C(l.form.count)+C(l.form.unit),1)])),_:1})])),_:1}),x(i,{style:{color:"#3c9cff"}},{default:h((()=>[T(C(l.form.traceCode),1)])),_:1})])),_:1},8,["onClick"])):(k(),p(u,{key:0,"footer-border":!1,background:"transparent"},{default:h((()=>[x(u,{onClick:s.actionToSelectBatch},{prefix:h((()=>[x(n,{src:N,style:{width:"48rpx",height:"48rpx"}})])),extra:h((()=>[x(c,{name:"right",size:"28rpx",color:"#666"})])),default:h((()=>[x(i,{style:{color:"#02B765"}},{default:h((()=>[T("请选择有生产过程批次")])),_:1})])),_:1},8,["onClick"])])),_:1})),x(q,{label:"合格方式"},{default:h((()=>[x(V,{modelValue:l.form.eligibleWay,"onUpdate:modelValue":t[0]||(t[0]=e=>l.form.eligibleWay=e),ref:"eligibleWayRef",col:"2",fill:"",options:s.config().dictData.chengnuoyiju},null,8,["modelValue","options"])])),_:1}),x(u,{"footer-border":!1,background:"transparent"},{footer:h((()=>[x(i,{class:"qua-cert-input-group col4"},{default:h((()=>[x(i,{class:"qua-cert-checkbox pl12 pr12"},{default:h((()=>[x(I,{modelValue:l.form.amount,"onUpdate:modelValue":t[1]||(t[1]=e=>l.form.amount=e),style:{width:"100%"},type:"text",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),x(i,{class:"qua-cert-checkbox pl12 pr12"},{default:h((()=>[T(C(l.form.unit),1)])),_:1}),x(i,{class:"qua-cert-checkbox pl12 pr12",style:{"grid-column-start":"3","grid-column-end":"5"}},{default:h((()=>[x(c,{name:"minus",color:"#A5ABB8",onClick:t[2]||(t[2]=()=>{l.form.issueSheets>0&&l.form.issueSheets--})}),x(I,{modelValue:l.form.issueSheets,"onUpdate:modelValue":t[3]||(t[3]=e=>l.form.issueSheets=e),style:{width:"100%","text-align":"center"},type:"text",placeholder:"请选择张数"},null,8,["modelValue"]),x(c,{name:"plus",color:"#A5ABB8",onClick:t[4]||(t[4]=e=>l.form.issueSheets++)})])),_:1})])),_:1})])),default:h((()=>[x(i,null,{default:h((()=>[T("重量和张数")])),_:1})])),_:1}),x(u,{"footer-border":!1,background:"transparent"},{footer:h((()=>[x(i,{class:"qua-cert-input-group col1"},{default:h((()=>[x(i,{class:"qua-cert-checkbox pl12 pr12"},{default:h((()=>[x(v,{value:l.form.address,onClick:t[5]||(t[5]=e=>s.actionJumpTo("/pages/address/select")),placeholder:"选择开具地址"},{icon:h((()=>[x(c,{name:"location-fill",color:"#2B8AF4"})])),_:1},8,["value"])])),_:1})])),_:1})])),default:h((()=>[x(i,null,{default:h((()=>[T("开具地点")])),_:1})])),_:1}),x(q,{label:"开具人员和操作时间",col:"3"},{default:h((()=>[x(D,null,{default:h((()=>[x(v,{onClick:t[6]||(t[6]=e=>s.actionJumpTo("/pages/employee/select")),placeholder:"请选择",value:l.form.productPerson},null,8,["value"])])),_:1}),x(D,{style:{"grid-column-start":"2","grid-column-end":"4"}},{default:h((()=>[x(E,{modelValue:l.form.issueTime,"onUpdate:modelValue":t[7]||(t[7]=e=>l.form.issueTime=e),hasInput:"","max-date":(new Date).getTime(),mode:"datetime",formatter:s.formatter},null,8,["modelValue","max-date","formatter"]),x(c,{name:"calendar",color:"#2B8AF4"})])),_:1})])),_:1})])),_:1}),x(i,{class:"qua-cert-footer"},{default:h((()=>[x(F,{style:{background:"#00b568",color:"#fff"},onClick:s.actionSubmit},{default:h((()=>[T("下一步 ")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-6b6875e6"]]);export{j as default};
