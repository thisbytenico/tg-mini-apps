import{_ as e,v as t,E as a,C as l,y as s,A as o,W as i,X as r,x as d,S as n,V as u,G as f,H as m,L as h,h as p,w as c,Y as y,p as V,g as _,i as b,l as g,K as w}from"./index-CBLTQg_b.js";import{_ as L}from"./u-upload.7eQRLVwx.js";import{_ as T}from"./dw-card.CeBHaIwR.js";import{_ as x}from"./u-button.D235zKSd.js";import"./u-loading-icon.Bdr6stTV.js";const C=e({name:"",components:{},data:()=>({form:{name:"",area:"",address:"",addressCode:"",addressName:"",manager:"",phone:"",longitude:"",latitude:"",picture:"",pictureTwo:"",status:"启用",unitName:"平方米"},isDefault:!0,fileList:[]}),onLoad(e){const{type:a,info:l}=e;try{if(l){let e=JSON.parse(decodeURIComponent(l));this.form.name=e.NAME,this.form.id=e.ID,this.form.phone=e.PHONE,this.form.name=e.NAME,this.form.address=e.ADDRESS,this.form.addressName=e.ADDRESS_NAME,this.form.addressCode=e.ADDRESS_CODE,this.form.area=e.AREA,this.form.longitude=e.LONGITUDE,this.form.latitude=e.LATITUDE,this.form.unitName=e.UNIT_NAME,this.form.manager=e.MANAGER,this.form.status="Y"===e.STATUS?"启用":"停用",this.$nextTick((()=>{this.$refs.myLocationRef.modelValue=e.LATITUDE+"-"+e.LONGITUDE,this.fileList=[e.PICTURE,e.PICTURE_TWO].filter((e=>e)).map((e=>({url:t.baseUrl+"/sofn-sys-web/sysTemplate/downPic?fileUrl="+e})))}))}}catch(s){}this.type=a,this.initPage()},watch:{},computed:{},methods:{actionJumpTo(e){a({url:e})},unitNameConfirm(e){this.form.unitName=e},statusConfirm(e){this.form.status="启用"===e?"Y":"N"},actionSubmit(){var e;if("选择区域"===this.$refs.myCityRef.getContent)return l("请选择所属区域");if(!this.$refs.myLocationRef.modelValue)return l("请选择经纬度");if(!this.form.name)return l("请输入名称");if(!this.form.address)return l("请输入车间详细地址");if(!this.form.area)return l("请输入车间面积");if(!this.form.manager)return l("请输入车间负责人");if(!this.form.phone)return l("请输入联系方式");if(11!=this.form.phone.length)return l("请输入正确的联系方式");this.fileList[0]&&(this.form.picture=this.fileList[0].url.replace(t.baseUrl+"/sofn-sys-web/sysTemplate/downPic?fileUrl=","")),this.fileList[1]&&(this.form.pictureTwo=this.fileList[1].url.replace(t.baseUrl+"/sofn-sys-web/sysTemplate/downPic?fileUrl=","")),this.form.latitude=this.$refs.myLocationRef.modelValue.split("-")[0],this.form.longitude=this.$refs.myLocationRef.modelValue.split("-")[1],(null==(e=this.$refs.myCityRef.cacheValue[3])?void 0:e.code)&&(this.form.addressCode=this.$refs.myCityRef.cacheValue[3].code),this.form.addressName=this.$refs.myCityRef.getContent;let a={...this.form};a.status="启用"===a.status?"Y":"N","add"===this.type?s.post("sofn-tts-web-branch/ttsScltxxcjWorkShop/addTtsScltxxcjWorkShop?id="+o("userInfo").id,{...a},{header:{token:o("token")},toast:!1}).then((e=>{200==e.httpCode?(l("保存成功"),setTimeout((()=>{i("refreshWorkshopList"),r()}),500)):l(e.msg)})):s.post("/sofn-tts-web-branch/ttsScltxxcjWorkShop/updateTtsScltxxcjWorkShop?id="+o("userInfo").id,{...a},{header:{token:o("token")},toast:!1}).then((e=>{200==e.httpCode?(l("保存成功"),setTimeout((()=>{i("refreshWorkshopList"),r()}),500)):l(e.msg)}))},actionDelete(e){this.fileList.splice(e.index,1),d({icon:"none",title:"删除图片"})},async afterRead(e){let t=[].concat(e.file),a=this.fileList.length;t.map((e=>{this.fileList.push({...e,status:"uploading",message:"上传中"})}));for(let l=0;l<t.length;l++){const e=await this.uploadFilePromise(t[l].url);let s=this.fileList[a];this.fileList.splice(a,1,{...s,status:"success",message:"",url:e}),a++}},uploadFilePromise:e=>new Promise(((a,l)=>{n({url:t.baseUrl+"/sofn-tts-web-branch/ttsScltxxcjRegiter/upload?fileapi17268223914946",filePath:e,name:"file",formData:{},success:e=>{setTimeout((()=>{let t=JSON.parse(e.data);a(t.path)}),1e3)}})})),initPage(){switch(this.type){case"add":this.pageTitle="新增车间";break;case"edit":this.pageTitle="编辑车间"}u({title:this.pageTitle})},ajaxXxx(){}}},[["render",function(e,t,a,l,s,o){const i=f(m("u-navbar"),y),r=w,d=h("myInputBox"),n=h("myFormItem"),u=h("myCity"),C=h("myLocation"),N=h("mySelectBox"),R=f(m("u-upload"),L),S=f(m("dw-card"),T),U=V,k=f(m("u-button"),x);return _(),p(U,{class:"workshop-edit"},{default:c((()=>[b(i,{title:e.pageTitle,autoBack:!0,placeholder:"",border:""},null,8,["title"]),b(U,{class:"workshop-edit-body"},{default:c((()=>[b(n,{label:"车间名称"},{default:c((()=>[b(d,null,{default:c((()=>[b(r,{modelValue:s.form.name,"onUpdate:modelValue":t[0]||(t[0]=e=>s.form.name=e),type:"text",placeholder:"请输入车间名称",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),b(n,{label:"所属区域"},{default:c((()=>[b(d,null,{default:c((()=>[b(u,{defaultValue:s.form.addressName,ref:"myCityRef",placeholder:"选择区域",title:"选择所属区域"},null,8,["defaultValue"])])),_:1})])),_:1}),b(n,{label:"车间详细地址"},{default:c((()=>[b(d,null,{default:c((()=>[b(r,{modelValue:s.form.address,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.address=e),type:"text",placeholder:"请输入地址",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),b(n,{label:"经纬度"},{default:c((()=>[b(d,null,{default:c((()=>[b(C,{keyword:s.form.address,ref:"myLocationRef",placeholder:"选择经纬度"},null,8,["keyword"])])),_:1})])),_:1}),b(n,{label:"车间面积/单位",col:"2"},{default:c((()=>[b(d,null,{default:c((()=>[b(r,{modelValue:s.form.area,"onUpdate:modelValue":t[2]||(t[2]=e=>s.form.area=e),type:"text",placeholder:"输入面积",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),b(d,null,{default:c((()=>[b(N,{modelValue:s.form.unitName,"onUpdate:modelValue":t[3]||(t[3]=e=>s.form.unitName=e),onOnConfirm:o.unitNameConfirm,placeholder:"请选择",title:"单位",defaultValue:"平方米",options:["平方米","舍","间","亩"]},null,8,["modelValue","onOnConfirm"])])),_:1})])),_:1}),b(n,{label:"车间负责人和车间状态",col:"2"},{default:c((()=>[b(d,null,{default:c((()=>[b(r,{modelValue:s.form.manager,"onUpdate:modelValue":t[4]||(t[4]=e=>s.form.manager=e),type:"text",placeholder:"输入车间负责人",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),b(d,null,{default:c((()=>[b(N,{modelValue:s.form.status,"onUpdate:modelValue":t[5]||(t[5]=e=>s.form.status=e),placeholder:"请选择",title:"车间状态",defaultValue:"启用",options:["启用","停用"]},null,8,["modelValue"])])),_:1})])),_:1}),b(n,{label:"联系方式"},{default:c((()=>[b(d,null,{default:c((()=>[b(r,{modelValue:s.form.phone,"onUpdate:modelValue":t[6]||(t[6]=e=>s.form.phone=e),type:"text",placeholder:"请输入联系方式",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),b(n,{label:"车间照片"},{default:c((()=>[b(S,null,{default:c((()=>[b(R,{fileList:s.fileList,onAfterRead:o.afterRead,onDelete:o.actionDelete,name:"1",multiple:"",maxCount:2},null,8,["fileList","onAfterRead","onDelete"])])),_:1})])),_:1})])),_:1}),b(U,{class:"workshop-edit-footer"},{default:c((()=>[b(k,{style:{background:"#00B568",color:"#FFF"},onClick:o.actionSubmit},{default:c((()=>[g("保存")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-84ad4a80"]]);export{C as default};
