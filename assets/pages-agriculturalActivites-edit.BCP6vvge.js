import{_ as t,al as e,v as a,$ as s,y as i,A as o,E as l,C as n,X as r,W as m,x as d,V as f,G as u,H as c,L as p,h,w as g,Y as k,p as _,O as N,g as y,i as T,l as U,t as x,J as I,a2 as b}from"./index-BdsNz36l.js";import{_ as A}from"./dw-card.CsilklMs.js";import{_ as C}from"./u-datetime-picker.p0m0mvIr.js";import{_ as w}from"./u-button.Di26Z4V2.js";import"./u-picker.jXgJyPg4.js";import"./u-loading-icon.BXA7DYQS.js";const j=t({name:"",components:{},data:()=>({taskNameList:[],timeFormat:e,isDefault:!0,pageTitle:"",txt:"",info:{},form:{taskName:"",remark:"",inputsAmount:"",inputsId:"",inputsName:"",inputsUnit:"",photoUrl:"",operationTime:"",handlerName:""}}),onLoad(t){this.ajaxGetDefaultUser();const{type:e,info:i,baseInfo:o}=t;if(console.log(i,o),"edit"===e)i&&(this.info=JSON.parse(decodeURIComponent(i)),console.log(this.info),this.form.taskName=this.info.operationName,this.form.remark=this.info.remark,this.form.handlerName=this.info.handlerName,this.form.operationTime=this.info.operationTime,this.form.inputsId=this.info.inputsId,this.form.inputsName=this.info.inputsName,this.form.inputsUnit=this.info.inputsUnit,this.form.inputsAmount=this.info.inputsNumber,this.form.photoUrl=this.info.photoUrl,this.taskNameList=a.industryCodes.find((t=>t.num===this.info.productType)).taskNameList,this.$nextTick((()=>{this.$refs.myFileUploadRef.fileList=this.info.photoUrl.split(",").map((t=>({resourceUrl:t})))})));else{if(i){let t=JSON.parse(decodeURIComponent(i));console.log(t),this.info.productName=t.AGRI_PRODUCT_NAME,this.info.productType=t.INDUSTRY_TYPE,this.info.landArea=t.AREA,this.form.agriProductionId=t.ID,this.info.unit=t.AREA_UNIT,this.form.operationTime=(new Date).getTime(),this.taskNameList=a.industryCodes.find((e=>e.num===t.INDUSTRY_TYPE)).taskNameList}if(o){console.log(o);let t=JSON.parse(decodeURIComponent(o));this.info.landName=t.NAME}}s("selectInputs",(t=>{console.log(t),this.form.inputsId=t.inputsId,this.form.inputsName=t.inputsName,this.form.inputsUnit=t.inputsUnit,this.form.inputsAmount=t.inputsAmount,t.isReplaceImage&&t.imageUrl&&this.$nextTick((()=>{this.$refs.myFileUploadRef.fileList=t.imageUrl.split(",").map((t=>({resourceUrl:t})))}))})),s("selectEmployee",(t=>{this.form.handlerName=t.STAFF_NAME})),this.type=e,this.initPage()},watch:{},computed:{},methods:{ajaxGetDefaultUser(){i.post("sofn-tts-web-branch/ttsScltxxcjStaff/getPageInfo",{start:0,length:99999,id:o("userInfo").id},{header:{"Content-Type":"application/x-www-form-urlencoded",token:o("token")},toast:!1}).then((t=>{if(t.data.list&&t.data.list.length>0){let e=t.data.list.find((t=>"Y"==t.DEFAULT_STATUS));e&&(this.form.handlerName=e.STAFF_NAME)}}))},getIcon(t){switch(t){case"01":return"batch_planting";case"02":return"batch_livestock";default:return"batch_water"}},clearInputs(){this.form.inputsId="",this.form.inputsName="",this.form.inputsUnit=""},actionJumpTo(t){l({url:t})},actionSubmit(){this.form.taskName?this.form.inputsId?this.form.inputsAmount?this.form.operationTime?this.form.handlerName?(this.form.photoUrl=this.$refs.myFileUploadRef.fileList.map((t=>t.resourceUrl)).join(","),"edit"==this.type?(this.form.id=this.info.farmId,i.post("sofn-tts-web-branch/ttsScltxxcjFarmingTask/updateFarmingTask?id="+o("userInfo").id,{...this.form},{header:{token:o("token")},toast:!1}).then((t=>{200==t.httpCode?(n("添加成功"),r({delta:1}),m("agriculturalActivitesRefresh")):n(t.msg)}))):i.post("sofn-tts-web-branch/ttsScltxxcjFarmingTask/addTtsScltxxcjFarmingTask?id="+o("userInfo").id,{...this.form},{header:{token:o("token")},toast:!1}).then((t=>{200==t.httpCode?(n("添加成功"),r({delta:1}),m("baseRefresh")):n(t.msg)}))):n("请选择负责人"):n("请选择操作时间"):n("请输入投入品数量"):n("请选择投入品"):n("请填写农事名称")},actionDelete(t){this.fileList.splice(t.index,1),d({icon:"none",title:"删除图片"})},afterRead(){},initPage(){switch(this.type){case"add":this.pageTitle="新增农事";break;case"edit":this.pageTitle="编辑农事"}f({title:this.pageTitle})},formatter:(t,e)=>"year"===t?`${e}年`:"month"===t?`${e}月`:"day"===t?`${e}日`:"hour"===t?`${e}时`:"minute"===t?`${e}分`:e,ajaxXxx(){}}},[["render",function(t,e,a,s,i,o){const l=u(c("u-navbar"),k),n=I,r=_,m=p("myCheckbox"),d=p("myFormItem"),f=b,j=u(c("dw-card"),A),F=u(c("dw-icon"),N),R=p("myContent"),S=p("myInputBox"),L=u(c("u-datetime-picker"),C),V=p("myFileUpload"),D=u(c("u-button"),w);return y(),h(r,{class:"agr-act-edit"},{default:g((()=>[T(l,{title:i.pageTitle,autoBack:!0,placeholder:"",border:""},null,8,["title"]),T(r,{class:"agr-act-edit-body"},{default:g((()=>[T(r,{class:"agr-act-edit-goods"},{default:g((()=>[T(n,{class:"agr-act-edit-goods-icon",src:"../../static/images/"+o.getIcon(i.info.productType)+".png"},null,8,["src"]),T(r,{class:"agr-act-edit-goods-body"},{default:g((()=>[T(r,{class:"flex justify-between"},{default:g((()=>[T(r,null,{default:g((()=>[U(x(i.info.productName),1)])),_:1}),T(r,null,{default:g((()=>[U("数量："+x(i.info.landArea)+x(i.info.unit),1)])),_:1})])),_:1}),T(r,{class:"flex justify-between"},{default:g((()=>[T(r,{class:"text-desc ft12"},{default:g((()=>[U("基地名称："+x(i.info.landName),1)])),_:1}),T(r,{class:"text-desc ft12"},{default:g((()=>[U("开始时间："+x(i.timeFormat(i.info.agriCreateTime,"yyyy-mm-dd")),1)])),_:1})])),_:1})])),_:1})])),_:1}),T(d,{label:"农事名称"},{default:g((()=>[T(m,{modelValue:i.form.taskName,"onUpdate:modelValue":e[0]||(e[0]=t=>i.form.taskName=t),defaultValue:i.form.taskName,options:i.taskNameList},null,8,["modelValue","defaultValue","options"])])),_:1}),T(d,{label:"备注"},{default:g((()=>[T(j,{shape:"square"},{default:g((()=>[T(f,{modelValue:i.form.remark,"onUpdate:modelValue":e[1]||(e[1]=t=>i.form.remark=t),style:{width:"100%"},type:"text",placeholder:"请输入农事详情叙述"},null,8,["modelValue"]),T(r,{class:"flex justify-end"},{default:g((()=>[T(r,{class:"agr-act-edit-clearbtn",onClick:e[2]||(e[2]=t=>i.form.remark="")},{default:g((()=>[U("清除")])),_:1})])),_:1})])),_:1}),i.form.inputsId?(y(),h(j,{key:1,shape:"square","custom-class":"mt12",onClick:o.clearInputs},{default:g((()=>[T(r,{class:"flex justify-between items-center"},{default:g((()=>[T(r,null,{default:g((()=>[U(x(i.form.inputsName),1)])),_:1}),T(r,null,{default:g((()=>[U(x(i.form.inputsAmount)+" "+x(i.form.inputsUnit)+" ",1),T(F,{name:"close-circle",color:"#666"})])),_:1})])),_:1})])),_:1},8,["onClick"])):(y(),h(j,{key:0,shape:"square","custom-class":"mt12",onClick:e[3]||(e[3]=t=>o.actionJumpTo("/pages/inputs/select"))},{default:g((()=>[T(r,{class:"flex justify-center items-center"},{default:g((()=>[T(F,{name:"plus-circle",color:"#4CB17C",class:"mr2"}),T(r,null,{default:g((()=>[U("添加投入品")])),_:1})])),_:1})])),_:1}))])),_:1}),T(d,{label:"负责人和操作时间",col:"3"},{default:g((()=>[T(S,null,{default:g((()=>[T(R,{onClick:e[4]||(e[4]=t=>o.actionJumpTo("/pages/employee/select")),placeholder:"请选择",value:i.form.handlerName},null,8,["value"])])),_:1}),T(S,{style:{"grid-column-start":"2","grid-column-end":"4"}},{default:g((()=>[T(L,{hasInput:"",modelValue:i.form.operationTime,"onUpdate:modelValue":e[5]||(e[5]=t=>i.form.operationTime=t),mode:"datetime","max-date":(new Date).getTime(),formatter:o.formatter},null,8,["modelValue","max-date","formatter"]),T(F,{name:"right",color:"#666",size:"24rpx"})])),_:1})])),_:1}),T(d,{label:"农事操作图片"},{default:g((()=>[T(j,{shape:"square"},{default:g((()=>[T(V,{ref:"myFileUploadRef"},null,512)])),_:1})])),_:1})])),_:1}),T(r,{class:"agr-act-edit-footer"},{default:g((()=>[T(D,{style:{background:"#00b568",color:"#fff"},onClick:o.actionSubmit},{default:g((()=>[U("保存 ")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-013dc8fe"]]);export{j as default};
