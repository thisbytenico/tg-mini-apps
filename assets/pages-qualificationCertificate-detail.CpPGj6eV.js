import{_ as e,v as t,E as s,V as a,y as i,A as o,x as l,G as n,H as r,h as c,w as u,Y as d,O as f,p,N as h,g as m,i as g,l as w,t as _,k as C,r as y,F as b,Z as x,aK as k,J as v,I as S,aL as T}from"./index-CBLTQg_b.js";import{_ as U}from"./u-picker.BPw4DyFW.js";import{h as P,_ as q}from"./save.DaWCNgLh.js";import"./u-loading-icon.Bdr6stTV.js";const L=e({name:"",components:{UPicker:U},data:()=>({certificationCode:"",show:!1,isShowPopup:!1,imgUrl:"",fileList:[],current:0}),onLoad(e){this.info=JSON.parse(decodeURIComponent(e.info)),this.certificationCode=this.info.certificationCode.split(",")[0],console.log(this.info),this.getTemplate()},watch:{},computed:{},methods:{change(e){console.log(e),this.current=e.detail.current},config:()=>t,actionJumpTo(e){s({url:e})},actionSave(){console.log(123,this.$refs["businessCard"+this.current]),P(this.$refs["businessCard"+this.current][0].$el,{allowTaint:!0,useCORS:!0,scale:2.5,backgroundColor:"transparent"}).then((e=>{this.imgUrl=e.toDataURL("image/png"),this.isShowPopup=!0}))},actionToSelectBatch(){s({url:"/pages/batch/select"})},actionSubmit(){s({url:"/pages/print/print"})},pickerConfirm({value:e}){this.certificationCode=e[0],this.show=!1},afterRead(){},initPage(){switch(this.type){case"add":this.pageTitle="新增农事";break;case"edit":this.pageTitle="编辑农事"}a({title:this.pageTitle})},getTemplate(){i.post("sofn-tts-web-branch/ttsCertification/getPrintTemplate?templateType=H",{},{header:{token:o("token")},toast:!1}).then((e=>{200!==e.httpCode&&l({icon:"none"}),this.fileList=e.data}))}}},[["render",function(e,t,s,a,i,o){const l=n(r("u-navbar"),d),P=n(r("dw-icon"),f),L=p,j=T,z=k,A=v,B=n(r("u-popup"),h),F=n(r("u-picker"),U);return m(),c(L,{class:"qua-cert"},{default:u((()=>[g(l,{title:"电子合格证",autoBack:!0,placeholder:"",border:""}),g(L,{class:"qua-cert-body"},{default:u((()=>[g(L,{class:"ft14 text-desc mb30",onClick:t[0]||(t[0]=e=>i.show=!0)},{default:u((()=>[w(" 证号："+_(i.certificationCode)+" ",1),g(P,{name:"down-fill",color:"#A1A9B5"})])),_:1}),g(z,{onChange:o.change,current:i.current,style:{width:"100%",height:"60vh"}},{default:u((()=>[(m(!0),C(b,null,y(i.fileList,((t,s)=>(m(),c(j,{key:s,style:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"}},{default:u((()=>[g(L,{ref_for:!0,ref:"businessCard"+s,class:"qua-cert-icon",style:{position:"relative"}},{default:u((()=>[x("img",{style:{width:"63vw",height:"100%"},src:o.config().baseUrl+"/sofn-sys-web/sysTemplate/downPic?fileUrl="+t.url},null,8,["src"]),"40mm*25mm"!==t.templateSize?(m(),c(L,{key:0,style:{"font-size":"12px",position:"absolute",bottom:"12vw",color:"#000",padding:"4px 40rpx","line-height":"20px"}},{default:u((()=>[g(L,{style:{display:"flex"}},{default:u((()=>[g(L,null,{default:u((()=>[w("产品名称："+_(e.info.productName),1)])),_:1}),g(L,{style:{"margin-left":"20rpx"}},{default:u((()=>[w("数量："+_(e.info.amount)+_(e.info.unit),1)])),_:1})])),_:1}),g(L,null,{default:u((()=>[w("产地:"+_(e.info.productAddress),1)])),_:1}),g(L,null,{default:u((()=>[w("联系方式:"+_(e.info.phone),1)])),_:1}),g(L,{style:{position:"relative"}},{default:u((()=>[w("电子签名 "),x("img",{style:{height:"50rpx",position:"absolute"},mode:"heightFix",src:o.config().baseUrl+"/sofn-sys-web/sysTemplate/downPic?fileUrl="+e.info.personSignUrl},null,8,["src"])])),_:1})])),_:1})):S("",!0)])),_:2},1536),g(L,{class:"qua-cert-title"},{default:u((()=>[w(_(t.templateName),1)])),_:2},1024),g(L,{class:"qua-cert-desc"},{default:u((()=>[w("尺寸："+_(t.templateSize),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange","current"])])),_:1}),g(L,{class:"qua-cert-footer"},{default:u((()=>[g(L,{class:"qua-cert-footer-btn",onClick:o.actionSave},{default:u((()=>[g(A,{class:"qua-cert-footer-btn-icon",mode:"widthFix",src:q}),g(L,null,{default:u((()=>[w("保存到本地相册")])),_:1})])),_:1},8,["onClick"])])),_:1}),g(L,null,{default:u((()=>[g(B,{show:i.isShowPopup,mode:"center",onClose:t[1]||(t[1]=e=>i.isShowPopup=!1),bgColor:"transparent"},{default:u((()=>[g(L,{style:{width:"90vw"}},{default:u((()=>[x("img",{src:i.imgUrl,mode:"widthFix",style:{width:"100%","border-radius":"20px"}},null,8,["src"]),g(L,{style:{"text-align":"center","font-size":"28rpx","margin-top":"30rpx",color:"#fff"}},{default:u((()=>[w("长按图片保存在相册")])),_:1})])),_:1})])),_:1},8,["show"])])),_:1}),g(F,{onConfirm:o.pickerConfirm,show:i.show,columns:[e.info.certificationCode.split(",")],onClose:t[2]||(t[2]=e=>i.show=!1)},null,8,["onConfirm","show","columns"])])),_:1})}],["__scopeId","data-v-a1ea223d"]]);export{L as default};
