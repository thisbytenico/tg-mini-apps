import{_ as e,al as t,A as o,$ as a,Q as l,v as i,E as s,C as u,y as r,X as d,x as n,V as m,G as c,H as p,L as f,h,w as y,Y as g,O as b,p as _,a4 as T,g as k,i as V,I as x,l as C,K as I}from"./index-Ci2ntzNm.js";import{_ as S}from"./u-datetime-picker.BwvSjS2q.js";import{_ as v}from"./dw-card.fADXVOCt.js";import{_ as U}from"./u-button.DGq9rRfM.js";import"./u-picker.umNqIkHP.js";import"./u-loading-icon.CX2H3iv7.js";const j=e({name:"",components:{},data(){return{isDefault:!0,pageTitle:"",fileList:[],unitsList:[],inputsType:[],form:{mediResult:"合格",productSource:this.config().dictData.ProductFrom[0],imgId:"",productId:"",inputsType:["无"],unit:"千克",harvestBasename:"",harvestTime:t((new Date).getTime(),"yyyy-mm-dd"),productName:"",spybIds:[],upEntName:"",productAmount:"",harvestBaseid:"",productIndustry:"",unitId:"",productSort:"",joinFlag:"",mediCheck:"自检"}}},onLoad(e){const{type:t,catalogue:l,num:i}=e;this.type=t,this.industry=i,"01"==this.industry?this.inputsType=["无","有机食品","绿色食品","农产品地理标识"]:this.inputsType=["无","无公害农产品","有机食品","绿色食品","农产品地理标识"];let s="1";switch(this.industry){case"01":break;case"02":s="6";break;case"03":s="4"}this.form.joinFlag=s,this.form.tempEnId=o("userInfo").id,this.catalogue=l,this.initPage(),this.ajaxGetUnitList(),a("agriculturalProduct",(e=>{console.log("选择了产品"),this.form.productName=e.NAME,this.form.productId=e.PRODUCT_CODE,this.form.productSort=e.TYPE_NAME,this.form.productIndustry=e.INDUSTRY})),a("base",(e=>{this.form.harvestBaseid=e.ID,this.form.harvestBasename=e.NAME})),a("customerSelect",(e=>{console.log(e),this.form.upEntName=e.NAME}))},onUnload(){l("agriculturalProduct"),l("base"),l("customerSelect")},watch:{},computed:{},methods:{inputsTypeChange(e){setTimeout((()=>{"无"==e[e.length-1]?this.form.inputsType=["无"]:this.form.inputsType=this.form.inputsType.filter((e=>"无"!==e))}),10)},config:()=>i,actionJumpTo(e){s({url:e})},actionToSelectProduct(){this.actionJumpTo("/pages/agriculturalProduct/index?mode=select&industry="+this.industry)},actionSubmit(){var e;this.form.unitId=null==(e=this.unitsList.find((e=>e.dictName==this.form.unit)))?void 0:e.id,this.form.imgId=this.$refs.myFileUploadImageRef.fileList.map((e=>e.resourceUrl)).join(","),this.form.videoId=this.$refs.myFileUploadVideoRef.fileList.map((e=>e.resourceUrl)).join(","),this.form.productId?"收购"!=this.form.productSource||this.form.upEntName?"自产"!=this.form.productSource||this.form.harvestBaseid?this.form.unitId?this.form.productName?this.form.productSort?this.form.productIndustry?this.form.productAmount?this.form.mediResult?r.post("sofn-tts-web-branch/ttsScltxxcjScgl/addCppcdj",{...this.form},{header:{token:o("token")},toast:!1}).then((e=>{200===e.httpCode?(u("操作成功"),setTimeout((()=>{d()}),500)):u(e.msg)})):u("请输入产品mediResult"):u("请输入产品数量"):u("请选择产品行业"):u("请选择产品类型"):u("请选择产品"):u("请选择单位"):u("请选择基地"):u("请选择上游主体"):u("请选择产品")},actionDelete(e){this.fileList.splice(e.index,1),n({icon:"none",title:"删除图片"})},afterRead(){},initPage(){let e="";switch(this.type){case"add":e="新建外追溯批次";break;case"edit":e="编辑外追溯批次"}this.catalogue&&(e+=`(${this.catalogue})`),this.pageTitle=e,m({title:this.pageTitle})},formatter:(e,t)=>"year"===e?`${t}年`:"month"===e?`${t}月`:"day"===e?`${t}日`:"hour"===e?`${t}时`:"minute"===e?`${t}分`:t,ajaxXxx(){},ajaxGetUnitList(){r.post("sofn-tts-web-branch/ttsScltxxcjScgl/getUnits",{id:i.industryCodes.find((e=>e.num===this.industry)).code},{header:{"Content-Type":"application/x-www-form-urlencoded",token:o("token")},toast:!1}).then((e=>{this.unitsList=e}))}}},[["render",function(e,t,o,a,l,i){const s=c(p("u-navbar"),g),u=f("myContent"),r=f("myInputBox"),d=f("mySelectBox"),n=f("myFormItem"),m=c(p("u-datetime-picker"),S),j=c(p("dw-icon"),b),w=I,N=_,E=f("myCheckbox"),R=c(p("dw-cell"),T),L=f("myFileUpload"),B=c(p("dw-card"),v),P=c(p("u-button"),U);return k(),h(N,{class:"batch-edit"},{default:y((()=>[V(s,{title:l.pageTitle,autoBack:!0,placeholder:"",border:""},null,8,["title"]),V(N,{class:"batch-edit-body"},{default:y((()=>[V(n,{label:"产品名称/产品来源",col:"2"},{default:y((()=>[V(r,null,{default:y((()=>[V(u,{value:l.form.productName,placeholder:"请选择产品",onClick:i.actionToSelectProduct},null,8,["value","onClick"])])),_:1}),V(r,null,{default:y((()=>[V(d,{modelValue:l.form.productSource,"onUpdate:modelValue":t[0]||(t[0]=e=>l.form.productSource=e),placeholder:"请选择",title:"产品来源",options:i.config().dictData.ProductFrom},null,8,["modelValue","options"])])),_:1})])),_:1}),V(n,{label:"收获时间",col:"2"},{default:y((()=>[V(r,{style:{padding:"0 24rpx 0 0 !important"}},{default:y((()=>[V(m,{modelValue:l.form.harvestTime,"onUpdate:modelValue":t[1]||(t[1]=e=>l.form.harvestTime=e),hasInput:"",mode:"date","max-date":(new Date).getTime(),formatter:i.formatter},null,8,["modelValue","max-date","formatter"]),V(j,{name:"calendar",color:"#278CEB"})])),_:1})])),_:1}),V(n,{label:"收获数量/单位",col:"2"},{default:y((()=>[V(r,null,{default:y((()=>[V(w,{modelValue:l.form.productAmount,"onUpdate:modelValue":t[2]||(t[2]=e=>l.form.productAmount=e),style:{width:"100%"},type:"text",placeholder:"请输入数量"},null,8,["modelValue"])])),_:1}),V(r,null,{default:y((()=>[V(d,{modelValue:l.form.unit,"onUpdate:modelValue":t[3]||(t[3]=e=>l.form.unit=e),placeholder:"请选择",title:"单位",options:l.unitsList.map((e=>e.dictName))},null,8,["modelValue","options"])])),_:1})])),_:1}),"自产"==l.form.productSource?(k(),h(n,{key:0,label:"收获基地名称"},{default:y((()=>[V(r,null,{default:y((()=>[V(u,{value:l.form.harvestBasename,placeholder:"请选择基地",onClick:t[4]||(t[4]=e=>i.actionJumpTo("/pages/base/select"))},null,8,["value"])])),_:1})])),_:1})):x("",!0),"收购"==l.form.productSource?(k(),h(n,{key:1,label:"上游主体名称"},{default:y((()=>[V(r,null,{default:y((()=>[V(u,{value:l.form.upEntName,placeholder:"请选择上游主体",onClick:t[5]||(t[5]=e=>i.actionJumpTo("/pages/customer/select"))},null,8,["value"])])),_:1})])),_:1})):x("",!0),V(n,{label:"自检情况/结论",col:"2"},{default:y((()=>[V(r,null,{default:y((()=>[V(d,{placeholder:"请选择",title:"质检情况",modelValue:l.form.mediCheck,"onUpdate:modelValue":t[6]||(t[6]=e=>l.form.mediCheck=e),defaultValue:"自检",options:["自检","委托检查","抽检"]},null,8,["modelValue"])])),_:1}),V(r,null,{default:y((()=>[V(d,{modelValue:l.form.mediResult,"onUpdate:modelValue":t[7]||(t[7]=e=>l.form.mediResult=e),placeholder:"请选择",title:"质检情况",options:["合格","不合格"]},null,8,["modelValue"])])),_:1})])),_:1}),V(R,{"footer-border":!1,background:"transparent"},{footer:y((()=>[V(E,{modelValue:l.form.inputsType,"onUpdate:modelValue":t[8]||(t[8]=e=>l.form.inputsType=e),ref:"inputsTypeRef",multiple:"",onOnChange:i.inputsTypeChange,options:l.inputsType},null,8,["modelValue","onOnChange","options"])])),default:y((()=>[V(N,null,{default:y((()=>[C("认证类型")])),_:1})])),_:1}),l.form.inputsType.includes("无")?x("",!0):(k(),h(R,{key:2,"footer-border":!1,background:"transparent"},{footer:y((()=>[])),default:y((()=>[V(N,{style:{display:"flex","justify-content":"space-between"}},{default:y((()=>[C("产品证书 "),V(N,{style:{color:"#06ae60"}},{default:y((()=>[C("添加产品证书")])),_:1})])),_:1})])),_:1})),V(n,{label:"批次图片"},{default:y((()=>[V(B,{shape:"square"},{default:y((()=>[V(L,{ref:"myFileUploadImageRef"},null,512)])),_:1})])),_:1}),V(n,{label:"批次视频"},{default:y((()=>[V(B,{shape:"square"},{default:y((()=>[V(L,{ref:"myFileUploadVideoRef",maxCount:"1",title:"选择视频"},null,512)])),_:1})])),_:1})])),_:1}),V(N,{class:"batch-edit-footer"},{default:y((()=>[V(P,{style:{background:"#00b568",color:"#fff"},onClick:i.actionSubmit},{default:y((()=>[C("下一步 ")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-3c3c25b5"]]);export{j as default};
